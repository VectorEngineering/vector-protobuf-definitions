name = "gateway"
main = "index.ts"
compatibility_date = "2024-01-01"

# Enable the AI binding
ai = { binding = true }

# Configure KV namespace for caching
kv_namespaces = [
  { binding = "CACHE", id = "xxxx", preview_id = "xxxx" }
]

# Configure environment variables
[vars]
API_SECRET_KEY = "xxxx"  # Replace with actual secret key
API_KEY = ""  # Add your API key here
SECRET = ""   # Add your secret here
ENVIRONMENT = "development"

# Configure routes
routes = [
  { pattern = "api.example.com/ai*", zone_id = "xxxx" }
]

# Configure dev settings
[dev]
port = 8787
local_protocol = "http"

# Configure miniflare for local development
[miniflare]
kv_persist = true
cache_persist = true

# Configure build settings
[build]
command = "npm run build"
watch_dir = "src"

[build.upload]
format = "modules"
main = "./index.mjs"
dir = "dist"

# Configure triggers
[triggers]
crons = []

# D1 Database binding
[[d1_databases]]
binding = "USERS_DATABASE"
database_name = "users"
database_id = ""  # Add your D1 database ID from Cloudflare Dashboard

# KV Namespace bindings
[[kv_namespaces]]
binding = "AUTH_STORE"
preview_id = "example_id_1"  # Add preview ID for local development
id = ""  # Add production ID from Cloudflare Dashboard

[[kv_namespaces]]
binding = "ENRICH_KV"
preview_id = "example_id_2"  # Add preview ID for local development
id = ""  # Add production ID from Cloudflare Dashboard

[[kv_namespaces]]
binding = "KV"
preview_id = "example_id_3"  # Add preview ID for local development
id = ""  # Add production ID from Cloudflare Dashboard

# R2 Bucket binding
[[r2_buckets]]
binding = "STORAGE"
bucket_name = "gateway-storage"  # Replace with your actual bucket name

# Service binding for TELLER_CERT
[[services]]
binding = "TELLER_CERT"
service = "teller-service"  # Replace with your actual service name

[env.production]
vars = { ENVIRONMENT = "production" }
# Add your production specific configuration here

[env.staging]
vars = { ENVIRONMENT = "staging" }
# Add your staging specific configuration here

[env.development]
vars = { ENVIRONMENT = "development" }
# Add your development specific configuration here 